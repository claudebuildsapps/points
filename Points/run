#!/bin/bash

# Colors for prettier output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Device UDID - using the connected device
DEVICE_ID="00008130-001A0C1914C3001C"

# App bundle identifier 
BUNDLE_ID="com.sokai.Points"

echo -e "${BLUE}Building Points app for device...${NC}"

# Build for iOS device - only rebuild what's changed
xcodebuild -project ../Points.xcodeproj -scheme Points -destination "id=$DEVICE_ID" -configuration Debug build -quiet

# Check if build succeeded
if [ $? -eq 0 ]; then
    echo -e "${GREEN}Build successful!${NC}"
    
    # Find the most recent build product path
    APP_PATH=$(find ~/Library/Developer/Xcode/DerivedData/Points-*/Build/Products/Debug-iphoneos -name "Points.app" -type d | head -n 1)
    
    echo -e "${BLUE}Installing and launching on device...${NC}"
    # Install and launch on device
    ios-deploy --id $DEVICE_ID --bundle "$APP_PATH" --no-wifi --justlaunch
    
    echo -e "${GREEN}App is now running on your device${NC}"
else
    echo -e "\033[0;31mBuild failed${NC}"
    exit 1
fi